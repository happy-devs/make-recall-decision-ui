{% extends "../../partials/layout.njk" %}

{% macro getRiskLevelText(level) %}
    {% if level == 'VERY_HIGH' %}
        Very high
    {% elif level == 'HIGH' %}
        High
    {% elif level == 'MEDIUM' %}
        Medium
    {% elif level == 'LOW' %}
        Low
    {% endif %}
{% endmacro %}

{% macro formatAddress(address) %}
    {% if not address.noFixedAbode %}
     <p class="govuk-body">
        {% if address.line1 %}
            {{ address.line1 }},
        {% endif %}
        {% if address.line2 %}
            {{ address.line2 }},
        {% endif %}
        {% if address.town %}
            {{ address.town }},
        {% endif %}
        {% if address.postcode %}
            {{ address.postcode }}
        {% endif %}
    </p>
    {% endif %}
{% endmacro %}

{% set pageTitle = makePageTitle({ pageHeading: pageTitles[page.id], hasErrors: errors }) %}

{% block beforeContent %}
    {{ backLink() }}
{% endblock %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds-from-desktop">

            <h1 class='govuk-heading-l'>{{ pageHeadings[page.id] }}</h1>

            <p class="govuk-body">
                These details are from NOMIS and the Part A.  They will go into the PPUD record.  You should:
            </p>

            <ul class='govuk-list govuk-list--number'>
                <li>Double-check everything is correct.</li>
                <li>Edit anything that's wrong.</li>
                <li>Continue to the next page and select the index offence.</li>
            </ul>

            {% if errorMessage %}
                {% set html %}
                    <h1 class="govuk-heading-m" data-qa='multiple-results'>Nomis Error</h1>
                    <span> {{errorMessage}}</span>
                {% endset %}

                {{ mojBanner({
                    type: 'warning',
                    html: html,
                    iconFallbackText: 'information'
                }) }}
            {% endif %}


            <form novalidate method="post">
                <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
                <input type="hidden" name="crn" value="{{ recommendation.crn }}" />
                <input type="hidden" name="isExtendedSentence" value="{{ recommendation.isExtendedSentence }}" />
                <input type="hidden" name="recallType" value="{{ recommendation.recallType.selected.value }}" />

                {{ listSummary('Personal details from NOMIS', [
                    {
                        "label": "Image",
                        "image": image
                    },
                    {
                        "label": "NOMIS number",
                        "value": recommendation.personOnProbation.nomsNumber,
                        "editLink": "xyz"
                    },
                    {
                        "label": "First name",
                        "value": prisonOffender.firstName,
                        "editLink": "xyz"
                    },
                    {
                        "label": "Second name",
                        "value": prisonOffender.middleName,
                        "editLink": "xyz"
                    },
                    {
                        "label": "Last name",
                        "value": prisonOffender.lastName,
                        "editLink": "xyz"
                    },
                    {
                        "label": "Gender",
                        "value": prisonOffender.gender,
                        "editLink": "xyz"
                    },
                    {
                        "label": "Ethnicity",
                        "value": prisonOffender.ethnicity,
                        "editLink": "xyz"
                    },
                    {
                        "label": "Date of birth",
                        "value": formatDateTimeFromIsoString({ isoDate: prisonOffender.dateOfBirth, dateOnly: true }),
                        "editLink": "xyz"
                    },
                    {
                        "label": "CRO",
                        "value": prisonOffender.CRO,
                        "editLink": "xyz"
                    },
                    {
                        "label": "PNC",
                        "value": prisonOffender.PNC,
                        "editLink": "xyz"
                    },
                    {
                        "label": "Prison booking number",
                        "value": prisonOffender.bookingNo,
                        "editLink": "xyz"
                    },
                    {
                        "label": "Releasing prison",
                        "editLink": "xyz"
                    },
                    {
                        "label": "Custody status",
                        "value": prisonOffender.locationDescription
                    },
                    {
                        "label": "Last known address",
                        "value": formatAddress(recommendation.personOnProbation.addresses) + recommendation.isMainAddressWherePersonCanBeFound.details,
                        "editLink": "xyz"
                    }
                ]) }}

                {{ listSummary('Probation details from the Part A', [
                    {
                        "label": "Recall received date",
                        "editLink": "xyz"
                    },
                    {
                        "label": "Recall received time",
                        "editLink": "xyz"
                    },
                    {
                        "label": "Recall decision date",
                        "value": formatDateTimeFromIsoString({ isoDate: poRecallConsultSpo.created, dateOnly: true })
                    },
                    {
                        "label": "Recall received time",
                        "value": formatDateTimeFromIsoString({ isoDate: poRecallConsultSpo.created, timeOnly: true })
                    },
                    {
                        "label": "Probation area",
                        "value": probationArea
                    },
                    {
                        "label": "Probation practitioner",
                        "value": practitioner.name
                    },
                    {
                        "label": "Probation practitioner email",
                        "value": practitioner.email
                    },
                    {
                        "label": "Probation practitioner phone number",
                        "value": practitioner.telephone
                    },
                    {
                        "label": "Local police contact",
                        "editLink": "xyz"
                    },
                    {
                        "label": "Senior manager (ACO)",
                        "value": acoSigned.createdByUserFullName
                    },
                    {
                        "label": "Senior manager (ACO) email",
                        "value": acoSigned.emailAddress
                    },
                    {
                        "label": "MAPPA level",
                        "value": "Level " + mappaLevel
                    },
                    {
                        "label": "Current risk of serious harm",
                        "value": getRiskLevelText(recommendation.roshSummary.riskOfSeriousHarm.overallRisk)
                    }
    
                ]) }}

                {{ govukDetails({
                  summaryText: "If you think the Part A is wrong",
                  text: "You can find the CRN at the end of the filename of the Part A.  It's always a letter followed by 6 numbers.  It might have a '.docx' after it."
                }) }}
                {{ formSubmitButton({ label: 'Accept and continue' }) }}
            </form>
        </div>
    </div>
{% endblock %}